---
- name: Ensure user password locak after 30 days of expire
  hosts: all
  become: true
  gather_facts: false
  tasks:
    - name: Collect the list of user
      shell: "egrep ^[^:]+:[^\\!*PASSWORDINAD] /etc/shadow | cut -d: -f1"
      register: user_output


    - name: Ensure user password locak after 30 days of expire in config file
      lineinfile:
        path: /etc/default/useradd
        regexp: "^INACTIVE="
        line: "INACTIVE=30"
        state: present

    - name: Ensure user password locak after 30 days of expire for all users
      shell: "chage --inactive 30 {{ item }}"
      with_items: "{{ user_output.stdout_lines }}"

